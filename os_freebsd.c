#include <unistd.h>

#include "os.h"

extern struct os_hook_s os_hook;

void freebsd_boot(struct term_s *);
void freebsd_shutdown(struct term_s *);

struct os_hook_s os_hook = {
    freebsd_boot,
    freebsd_shutdown
};

void freebsd_boot(struct term_s *term){
    term_printf(term, "Copyright (c) 1992-2018 The FreeBSD Project.\n"); usleep(50000);
    term_printf(term, "Copyright (c) 1979, 1980, 1983, 1986, 1988, 1989, 1991, 1992, 1993, 1994\n"); usleep(50000);
    term_printf(term, "The Regents of the University of California. All rights reserved.\n"); usleep(50000);
    term_printf(term, "FreeBSD is a registered trademark of The FreeBSD Foundation.\n"); usleep(50000);
    term_printf(term, "FreeBSD 11.2-RELEASE #0 r335510: Fri Jun 22 04:32:14 UTC 2018\n"); usleep(50000);
    term_printf(term, "root@releng2.nyi.freebsd.org:/usr/obj/usr/src/sys/GENERIC amd64\n"); usleep(50000);
    term_printf(term, "FreeBSD clang version 6.0.0 (tags/RELEASE_600/final 326565) (based on LLVM 6.0.0)\n"); usleep(50000);
    term_printf(term, "VT(vga): text 80x25\n"); usleep(50000);
    term_printf(term, "CPU: Intel(R) Xeon(R) CPU E5-2620 0 @ 2.00GHz (2000.00-MHz K8-class CPU)\n"); usleep(50000);
    term_printf(term, "Origin=\"GenuineIntel\"  Id=0x106a4  Family=0x6  Model=0x1a  Stepping=4\n"); usleep(50000);
    term_printf(term, "Features=0xf83fbff<FPU,VME,DE,PSE,TSC,MSR,PAE,MCE,CX8,APIC,SEP,MTRR,PGE,MCA,CMOV,PAT,PSE36,MMX,FXSR,SSE,SSE2,SS>\n"); usleep(50000);
    term_printf(term, "Features2=0x81b82201<SSE3,SSSE3,CX16,SSE4.1,SSE4.2,x2APIC,POPCNT,TSCDLT,HV>\n"); usleep(50000);
    term_printf(term, "AMD Features=0x28100800<SYSCALL,NX,RDTSCP,LM>\n"); usleep(50000);
    term_printf(term, "AMD Features2=0x1<LAHF>\n"); usleep(50000);
    term_printf(term, "Structured Extended Features=0x2<TSCADJ>\n"); usleep(50000);
    term_printf(term, "Structured Extended Features3=0x2c000000<IBPB,STIBP,ARCH_CAP>\n"); usleep(50000);
    term_printf(term, "IA32_ARCH_CAPS=0x4\n"); usleep(50000);
    term_printf(term, "TSC: P-state invariant\n"); usleep(50000);
    term_printf(term, "Hypervisor: Origin = \"VMwareVMware\"\n"); usleep(50000);
    term_printf(term, "real memory  = 8589934592 (8192 MB)\n"); usleep(50000);
    term_printf(term, "avail memory = 8251731968 (7869 MB)\n"); usleep(50000);
    term_printf(term, "Event timer \"LAPIC\" quality 600\n"); usleep(50000);
    term_printf(term, "ACPI APIC Table: <PTLTD      APIC  >\n"); usleep(50000);
    term_printf(term, "FreeBSD/SMP: Multiprocessor System Detected: 4 CPUs\n"); usleep(50000);
    term_printf(term, "FreeBSD/SMP: 4 package(s)\n"); usleep(50000);
    term_printf(term, "MADT: Forcing active-low polarity and level trigger for SCI\n"); usleep(50000);
    term_printf(term, "ioapic0 <Version 2.0> irqs 0-23 on motherboard\n"); usleep(50000);
    term_printf(term, "SMP: AP CPU #2 Launched!\n"); usleep(50000);
    term_printf(term, "SMP: AP CPU #3 Launched!\n"); usleep(50000);
    term_printf(term, "SMP: AP CPU #1 Launched!\n"); usleep(50000);
    term_printf(term, "random: entropy device external interface\n"); usleep(50000);
    term_printf(term, "kbd1 at kbdmux0\n"); usleep(50000);
    term_printf(term, "netmap: loaded module\n"); usleep(50000);
    term_printf(term, "module_register_init: MOD_LOAD (vesa, 0xffffffff80ff4550, 0) error 19\n"); usleep(50000);
    term_printf(term, "nexus0\n"); usleep(50000);
    term_printf(term, "vtvga0: <VT VGA driver> on motherboard\n"); usleep(50000);
    term_printf(term, "cryptosoft0: <software crypto> on motherboard\n"); usleep(50000);
    term_printf(term, "acpi0: <INTEL 440BX> on motherboard\n"); usleep(50000);
    term_printf(term, "acpi0: Power Button (fixed)\n"); usleep(50000);
    term_printf(term, "hpet0: <High Precision Event Timer> iomem 0xfed00000-0xfed003ff on acpi0\n"); usleep(50000);
    term_printf(term, "Timecounter \"HPET\" frequency 14318180 Hz quality 950\n"); usleep(50000);
    term_printf(term, "cpu0: <ACPI CPU> numa-domain 0 on acpi0\n"); usleep(50000);
    term_printf(term, "cpu1: <ACPI CPU> numa-domain 0 on acpi0\n"); usleep(50000);
    term_printf(term, "cpu2: <ACPI CPU> numa-domain 0 on acpi0\n"); usleep(50000);
    term_printf(term, "cpu3: <ACPI CPU> numa-domain 0 on acpi0\n"); usleep(50000);
    term_printf(term, "attimer0: <AT timer> port 0x40-0x43 irq 0 on acpi0\n"); usleep(50000);
    term_printf(term, "Timecounter \"i8254\" frequency 1193182 Hz quality 0\n"); usleep(50000);
    term_printf(term, "Event timer \"i8254\" frequency 1193182 Hz quality 100\n"); usleep(50000);
    term_printf(term, "atrtc0: <AT realtime clock> port 0x70-0x71 irq 8 on acpi0\n"); usleep(50000);
    term_printf(term, "atrtc0: registered as a time-of-day clock, resolution 1.000000s\n"); usleep(50000);
    term_printf(term, "Event timer \"RTC\" frequency 32768 Hz quality 0\n"); usleep(50000);
    term_printf(term, "Timecounter \"ACPI-fast\" frequency 3579545 Hz quality 900\n"); usleep(50000);
    term_printf(term, "acpi_timer0: <24-bit timer at 3.579545MHz> port 0x1008-0x100b on acpi0\n"); usleep(50000);
    term_printf(term, "pcib0: <ACPI Host-PCI bridge> port 0xcf8-0xcff on acpi0\n"); usleep(50000);
    term_printf(term, "pci0: <ACPI PCI bus> on pcib0\n"); usleep(50000);
    term_printf(term, "pcib1: <ACPI PCI-PCI bridge> at device 1.0 on pci0\n"); usleep(50000);
    term_printf(term, "pci1: <ACPI PCI bus> on pcib1\n"); usleep(50000);
    term_printf(term, "isab0: <PCI-ISA bridge> at device 7.0 on pci0\n"); usleep(50000);
    term_printf(term, "isa0: <ISA bus> on isab0\n"); usleep(50000);
    term_printf(term, "atapci0: <Intel PIIX4 UDMA33 controller> port 0x1f0-0x1f7,0x3f6,0x170-0x177,0x376,0x1060-0x106f at device 7.1 on pci0\n"); usleep(50000);
    term_printf(term, "ata0: <ATA channel> at channel 0 on atapci0\n"); usleep(50000);
    term_printf(term, "ata1: <ATA channel> at channel 1 on atapci0\n"); usleep(50000);
    term_printf(term, "pci0: <bridge> at device 7.3 (no driver attached)\n"); usleep(50000);
    term_printf(term, "vgapci0: <VGA-compatible display> port 0x1070-0x107f mem 0xe8000000-0xefffffff,0xfe000000-0xfe7fffff irq 16 at device 15.0 on pci0\n"); usleep(50000);
    term_printf(term, "vgapci0: Boot video device\n"); usleep(50000);
    term_printf(term, "pcib2: <ACPI PCI-PCI bridge> at device 17.0 on pci0\n"); usleep(50000);
    term_printf(term, "pci2: <ACPI PCI bus> on pcib2\n"); usleep(50000);
    term_printf(term, "pcib3: <ACPI PCI-PCI bridge> at device 21.0 on pci0\n"); usleep(50000);
    term_printf(term, "pcib3: [GIANT-LOCKED]\n"); usleep(50000);
    term_printf(term, "pci3: <ACPI PCI bus> on pcib3\n"); usleep(50000);
    term_printf(term, "mpt0: <LSILogic SAS/SATA Adapter> port 0x4000-0x40ff mem 0xfd5ec000-0xfd5effff,0xfd5f0000-0xfd5fffff irq 18 at device 0.0 on pci3\n"); usleep(50000);
    term_printf(term, "mpt0: MPI Version=1.5.0.0\n"); usleep(50000);
    term_printf(term, "pcib4: <ACPI PCI-PCI bridge> at device 21.1 on pci0\n"); usleep(50000);
    term_printf(term, "pcib4: [GIANT-LOCKED]\n"); usleep(50000);
    term_printf(term, "pcib5: <ACPI PCI-PCI bridge> at device 21.2 on pci0\n"); usleep(50000);
    term_printf(term, "pcib5: [GIANT-LOCKED]\n"); usleep(50000);
    term_printf(term, "pcib6: <ACPI PCI-PCI bridge> at device 21.3 on pci0\n"); usleep(50000);
    term_printf(term, "pcib6: [GIANT-LOCKED]\n"); usleep(50000);
    term_printf(term, "pcib7: <ACPI PCI-PCI bridge> at device 21.4 on pci0\n"); usleep(50000);
    term_printf(term, "pcib7: [GIANT-LOCKED]\n"); usleep(50000);
    term_printf(term, "pcib8: <ACPI PCI-PCI bridge> at device 21.5 on pci0\n"); usleep(50000);
    term_printf(term, "pcib8: [GIANT-LOCKED]\n"); usleep(50000);
    term_printf(term, "pcib9: <ACPI PCI-PCI bridge> at device 21.6 on pci0\n"); usleep(50000);
    term_printf(term, "pcib9: [GIANT-LOCKED]\n"); usleep(50000);
    term_printf(term, "pcib10: <ACPI PCI-PCI bridge> at device 21.7 on pci0\n"); usleep(50000);
    term_printf(term, "pcib10: [GIANT-LOCKED]\n"); usleep(50000);
    term_printf(term, "pcib11: <ACPI PCI-PCI bridge> at device 22.0 on pci0\n"); usleep(50000);
    term_printf(term, "pcib11: [GIANT-LOCKED]\n"); usleep(50000);
    term_printf(term, "pci4: <ACPI PCI bus> on pcib11\n"); usleep(50000);
    term_printf(term, "vmx0: <VMware VMXNET3 Ethernet Adapter> port 0x5000-0x500f mem 0xfd4fc000-0xfd4fcfff,0xfd4fd000-0xfd4fdfff,0xfd4fe000-0xfd4fffff irq 19 at device 0.0 on pci4\n"); usleep(50000);
    term_printf(term, "vmx0: Ethernet address: 00:50:56:93:76:08\n"); usleep(50000);
    term_printf(term, "pcib12: <ACPI PCI-PCI bridge> at device 22.1 on pci0\n"); usleep(50000);
    term_printf(term, "pcib12: [GIANT-LOCKED]\n"); usleep(50000);
    term_printf(term, "pcib13: <ACPI PCI-PCI bridge> at device 22.2 on pci0\n"); usleep(50000);
    term_printf(term, "pcib13: [GIANT-LOCKED]\n"); usleep(50000);
    term_printf(term, "pcib14: <ACPI PCI-PCI bridge> at device 22.3 on pci0\n"); usleep(50000);
    term_printf(term, "pcib14: [GIANT-LOCKED]\n"); usleep(50000);
    term_printf(term, "pcib15: <ACPI PCI-PCI bridge> at device 22.4 on pci0\n"); usleep(50000);
    term_printf(term, "pcib15: [GIANT-LOCKED]\n"); usleep(50000);
    term_printf(term, "pcib16: <ACPI PCI-PCI bridge> at device 22.5 on pci0\n"); usleep(50000);
    term_printf(term, "pcib16: [GIANT-LOCKED]\n"); usleep(50000);
    term_printf(term, "acpi_acad0: <AC Adapter> on acpi0\n"); usleep(50000);
    term_printf(term, "atkbdc0: <Keyboard controller (i8042)> port 0x60,0x64 irq 1 on acpi0\n"); usleep(50000);
    term_printf(term, "atkbd0: <AT Keyboard> irq 1 on atkbdc0\n"); usleep(50000);
    term_printf(term, "kbd0 at atkbd0\n"); usleep(50000);
    term_printf(term, "atkbd0: [GIANT-LOCKED]\n"); usleep(50000);
    term_printf(term, "psm0: <PS/2 Mouse> irq 12 on atkbdc0\n"); usleep(50000);
    term_printf(term, "psm0: [GIANT-LOCKED]\n"); usleep(50000);
    term_printf(term, "psm0: model IntelliMouse, device ID 3\n"); usleep(50000);
    term_printf(term, "acpi_syscontainer0: <System Container> on acpi0\n"); usleep(50000);
    term_printf(term, "orm0: <ISA Option ROMs> at iomem 0xc0000-0xc7fff,0xc8000-0xc9fff,0xca000-0xcafff,0xdc000-0xdffff,0xe0000-0xe7fff on isa0\n"); usleep(50000);
    term_printf(term, "vga0: <Generic ISA VGA> at port 0x3c0-0x3df iomem 0xa0000-0xbffff on isa0\n"); usleep(50000);
    term_printf(term, "ppc0: cannot reserve I/O port range\n"); usleep(50000);
    term_printf(term, "ZFS filesystem version: 5\n"); usleep(50000);
    term_printf(term, "ZFS storage pool version: features support (5000)\n"); usleep(50000);
    term_printf(term, "Timecounters tick every 10.000 msec\n"); usleep(50000);
    term_printf(term, "usb_needs_explore_all: no devclass\n"); usleep(50000);
    term_printf(term, "cd0 at ata0 bus 0 scbus0 target 0 lun 0\n"); usleep(50000);
    term_printf(term, "cd0: <NECVMWar VMware IDE CDR00 1.00> Removable CD-ROM SCSI device\n"); usleep(50000);
    term_printf(term, "cd0: Serial Number 00000000000000000001\n"); usleep(50000);
    term_printf(term, "cd0: 33.300MB/s transfers (UDMA2, ATAPI 12bytes, PIO 65534bytes)\n"); usleep(50000);
    term_printf(term, "cd0: 669MB (342562 2048 byte sectors)\n"); usleep(50000);
    term_printf(term, "da0 at mpt0 bus 0 scbus2 target 0 lun 0\n"); usleep(50000);
    term_printf(term, "da0: <VMware Virtual disk 2.0> Fixed Direct Access SPC-4 SCSI device\n"); usleep(50000);
    term_printf(term, "da0: 300.000MB/s transfers\n"); usleep(50000);
    term_printf(term, "da0: Command Queueing enabled\n"); usleep(50000);
    term_printf(term, "da0: 32768MB (67108864 512 byte sectors)\n"); usleep(50000);
    term_printf(term, "da0: quirks=0x140<RETRY_BUSY,STRICT_UNMAP>\n"); usleep(50000);
    term_printf(term, "Trying to mount root from zfs:zroot/ROOT/default []...\n"); usleep(50000);
    term_printf(term, "random: unblocking device.\n"); usleep(50000);
    term_printf(term, "vmx0: link state changed to UP\n"); usleep(50000);
    term_printf(term, "\n");
    sleep(1);
    term_printf(term, "FreeBSD 11.2-RELEASE-p9 (GENERIC) #0: Tue Feb  5 15:30:36 UTC 2019\n");
    term_printf(term, "\n");
    term_printf(term, "Welcome to FreeBSD!\n");
    term_printf(term, "\n");
    term_printf(term, "Release Notes, Errata: https://www.FreeBSD.org/releases/\n");
    term_printf(term, "Security Advisories:   https://www.FreeBSD.org/security/\n");
    term_printf(term, "FreeBSD Handbook:      https://www.FreeBSD.org/handbook/\n");
    term_printf(term, "FreeBSD FAQ:           https://www.FreeBSD.org/faq/\n");
    term_printf(term, "Questions List: https://lists.FreeBSD.org/mailman/listinfo/freebsd-questions/\n");
    term_printf(term, "FreeBSD Forums:        https://forums.FreeBSD.org/\n");
    term_printf(term, "\n");
    term_printf(term, "\n");
    sleep(3);
}

void freebsd_shutdown(struct term_s *term){
    term_printf(term, "Waiting (max 60 seconds) for system process `vnlru' to stop... ");
    sleep(2);
    term_printf(term, "done\n");
    term_printf(term, "Waiting (max 60 seconds) for system process `bufdaemon' to stop... ");
    sleep(1);
    term_printf(term, "done\n");
    term_printf(term, "Waiting (max 60 seconds) for system process `syncer' to stop...\n");
    sleep(1);
    term_printf(term, "Syncing disks, vnodes remaining... ");
    sleep(1);
    term_printf(term, "0 ");
    sleep(1);
    term_printf(term, "0 ");
    sleep(1);
    term_printf(term, "0 0 0 done\n");
    term_printf(term, "All buffers synced.\n");
    term_printf(term, "Uptime: 3m58s\n");
    sleep(2);
}

